<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Caisse ‚Äì Bar (onglets + d√©tail)</title>
<style>
  :root{--bg:#0f1217;--panel:#171b22;--text:#e6e9ef;--muted:#9aa3b2;--accent:#3b82f6;--warn:#ef4444}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{padding:12px;background:var(--panel);display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:18px}
  .btn{height:36px;border-radius:10px;border:1px solid #243042;background:#0b1016;color:#fff;padding:0 12px;cursor:pointer}
  .btn.warn{background:#2a1515;border-color:#3a2222;color:#ffb4b4}
  /* Tabs */
  .tabs{display:flex;gap:6px;overflow:auto;padding:8px 12px;background:#0e131a;border-bottom:1px solid #222833}
  .tab{padding:6px 12px;border-radius:999px;border:1px solid #243042;background:#0b1016;color:var(--text);cursor:pointer;white-space:nowrap;font-size:14px}
  .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
  /* Grid produits */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;padding:12px}
  .item{appearance:none;-webkit-appearance:none;border:1px solid #222833;background:#0e131a;color:inherit;border-radius:12px;padding:10px;cursor:pointer;position:relative;text-align:center}
  .item .emo{display:block;font-size:24px;margin-bottom:4px}
  .item .badge{position:absolute;top:6px;right:6px;background:var(--accent);color:#fff;border-radius:999px;padding:2px 6px;font-size:12px;display:none}
  /* Totaux + d√©tail */
  .panel{background:var(--panel);margin:12px;border-radius:12px;padding:12px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap}
  .big{font-size:26px;font-weight:800}
  .muted{color:var(--muted);font-size:12px}
  .chev{font-size:16px;color:var(--muted)}
  #details{margin-top:8px;border-top:1px dashed #243042;padding-top:8px}
  .line{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:6px 0}
  .remove{border:1px solid #3a2222;background:#2a1515;color:#ffb4b4;border-radius:8px;height:28px;padding:0 8px;cursor:pointer}
</style>
</head>
<body>
  <header>
    <h1>üçπ Foyer - Bar- CRS 08 </h1>
    <button class="btn warn" id="clear">Vider la commande</button>
  </header>

  <!-- Onglets -->
  <div class="tabs" id="tabs"></div>

  <!-- Zone produits -->
  <div class="grid" id="grid"></div>

  <!-- Totaux + d√©tail -->
  <div class="panel" id="totalsPanel">
    <div class="row">
      <div>
        <div class="muted">Total</div>
        <div class="big" id="totalTxt">0,00 ‚Ç¨</div>
      </div>
      <div>
        <div class="muted">Articles</div>
        <div class="big"><span id="countTxt">0</span> <span class="chev" id="chev">‚ñ∏</span></div>
      </div>
    </div>
    <div id="details" hidden></div>
  </div>

<script>
/* ====== Format mon√©taire (centimes) ====== */
const fmt = new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'});
const toC = v => Math.round(parseFloat(String(v).replace(',','.'))*100);
const fromC = c => fmt.format(c/100);

/* ====== Donn√©es : cat√©gories + produits (depuis ta photo) ====== */
const categories = {
  "‚òï Chauds": [
    {id:"cafe",name:"Caf√©",price:0.50,emo:"‚òï"},
    {id:"infusion",name:"Infusion",price:0.20,emo:"üçµ"},
    {id:"choco",name:"Chocolat chaud",price:0.50,emo:"üç´"}
  ],
  "ü•§ Fra√Æches": [
    {id:"boitage",name:"Boitage (canettes)",price:0.80,emo:"ü•§"},
    {id:"jus",name:"Jus de fruits",price:0.90,emo:"üßÉ"},
    {id:"eau-plate",name:"Eau plate",price:0.30,emo:"üíß"},
    {id:"eau-gaz",name:"Eau gazeuse",price:0.70,emo:"üí¶"},
    {id:"limonade-verre",name:"Limonade (verre)",price:0.20,emo:"ü•§"},
    {id:"limonade-btl",name:"Limonade (bouteille)",price:1.20,emo:"ü´ô"}
  ],
  "üç∫ Bi√®res": [
    {id:"biere-spe",name:"Bi√®res sp√©ciales",price:2.00,emo:"üçª"},
    {id:"pelforth-pression",name:"Pelforth pression",price:1.00,emo:"üç∫"},
    {id:"lindemans-pression",name:"Lindemans pression",price:1.50,emo:"üç∫"},
    {id:"hoegaarden-btl",name:"Hoegaarden",price:1.00,emo:"üç∫"},
    {id:"grimbergen-btl",name:"Grimbergen",price:1.00,emo:"üç∫"},
    {id:"heineken-btl",name:"Heineken",price:1.00,emo:"üç∫"},
    {id:"1664-btl",name:"1664",price:1.00,emo:"üç∫"},
    {id:"leffe-btl",name:"Leffe",price:1.50,emo:"üç∫"},
    {id:"desperados-btl",name:"Despe",price:1.50,emo:"üç∫"},
     {id:"tourtel",name:"Tourtel Twist",price:1.00,emo:"üç∫"},
    ],
  "üç∑ Vins": [
    {id:"rose-verre",name:"Vin ros√© (verre)",price:0.60,emo:"üç∑"},
    {id:"blanc-verre",name:"Vin blanc (verre)",price:0.90,emo:"ü•Ç"},
    {id:"rose-btl",name:"Vin ros√© (btl)",price:4.50,emo:"üç∑"},
    {id:"blanc-btl",name:"Vin blanc (btl)",price:6.75,emo:"ü•Ç"},
    {id:"crs-or",name:"Vin CRS 08 Or",price:6.00,emo:"üçæ"},
    {id:"crs-rouge",name:"Vin CRS 08 Rouge",price:8.00,emo:"üçæ"},
    {id:"beaujolais",name:"Beaujolais",price:4.50,emo:"üç∑"},
    {id:"champagne",name:"Champagne",price:18.00,emo:"üçæ"}
  ],
  "üç¨ Confiseries": [
    {id:"cotedor",name:"C√¥te d'Or",price:1.00,emo:"üç´"},
    {id:"kitkat",name:"KitKat",price:0.50,emo:"üç´"},
    {id:"bounty",name:"Bounty",price:0.50,emo:"ü••"},
    {id:"mars",name:"Mars",price:0.50,emo:"üç´"},
    {id:"snickers",name:"Snickers",price:0.50,emo:"üç´"},
    {id:"lion",name:"Lion",price:0.50,emo:"üç´"},
    {id:"bueno",name:"Kinder Bueno",price:0.70,emo:"üç´"},
    {id:"suchard",name:"Rocher Suchard",price:0.70,emo:"üç´"}
  ],
  "üö¨ Cigarettes": [
    {id:"marlboro-red",name:"Marlboro Red",price:13.50,emo:"üö¨"},
    {id:"marlboro-gold",name:"Marlboro Gold",price:13.50,emo:"üö¨"},
    {id:"philip-morris",name:"Philip Morris",price:12.00,emo:"üö¨"}
  ],
  "ü•® Snacks": [
    {id:"gateau-ap",name:"G√¢teau ap√©ritif",price:1.30,emo:"ü•®"},
    {id:"saucisson",name:"Saucisson",price:4.00,emo:"üêñ"},
    {id:"fuet",name:"Fuet / barquette",price:3.00,emo:"üêñ"}
  ],
  "üß∫ Divers": [
    {id:"dose-lessive",name:"Dose lessive",price:0.60,emo:"üßº"},
    {id:"jeton-machine",name:"Jeton machine",price:1.60,emo:"ü™ô"},
    {id:"papier-toilette",name:"Papier toilette",price:0.40,emo:"üßª"},
    {id:"mousse-raser",name:"Mousse √† raser",price:2.00,emo:"ü™í"}
  ],
  "üëï Utilitaire CRS": [
    {id:"calot",name:"Calot",price:26.00,emo:"üéì"},
    {id:"flamme-calot",name:"Flamme de calot",price:3.50,emo:"üî•"},
    {id:"galon-poitrine",name:"Galon poitrine",price:3.20,emo:"üéñÔ∏è"},
    {id:"manchon",name:"Manchon",price:7.00,emo:"üß§"},
    {id:"galon-calot-gd",name:"Galon calot GD",price:3.00,emo:"üéñÔ∏è"},
    {id:"tee-crs",name:"Tee-shirt CRS",price:8.10,emo:"üëï"},
    {id:"tee-crs8-brode",name:"Tee-shirt CRS8 brod√©",price:11.00,emo:"üëï"},
    {id:"polo-crs",name:"Polo CRS",price:20.00,emo:"üëï"},
    {id:"pucelle",name:"Pucelle",price:7.00,emo:"üéñÔ∏è"},
    {id:"medaille",name:"M√©daille CRS",price:20.00,emo:"üèÖ"},
    {id:"temoin",name:"T√©moin chambre vide",price:3.00,emo:"ü™™"},
    {id:"pince-cravate",name:"Pince cravate",price:8.00,emo:"üëî"}
  ]
};

/* ====== √âtat : compteurs par produit ====== */
const counters = {};
Object.values(categories).flat().forEach(p=>counters[p.id]=0);

/* ====== √âl√©ments ====== */
const $tabs=document.getElementById('tabs');
const $grid=document.getElementById('grid');
const $totalTxt=document.getElementById('totalTxt');
const $countTxt=document.getElementById('countTxt');
const $details=document.getElementById('details');
const $totalsPanel=document.getElementById('totalsPanel');
const $chev=document.getElementById('chev');
const $clear=document.getElementById('clear');

let activeCat = Object.keys(categories)[0];

/* ====== Rendu onglets ====== */
function renderTabs(){
  $tabs.innerHTML="";
  Object.keys(categories).forEach(cat=>{
    const b=document.createElement('button');
    b.className='tab'+(cat===activeCat?' active':'');
    b.textContent=cat;
    b.onclick=()=>{activeCat=cat;renderTabs();renderGrid();};
    $tabs.appendChild(b);
  });
}

/* ====== Rendu produits de l‚Äôonglet ====== */
function renderGrid(){
  $grid.innerHTML="";
  categories[activeCat].forEach(p=>{
    const btn=document.createElement('button');
    btn.type='button'; btn.className='item'; btn.dataset.id=p.id;
    btn.innerHTML=`<span class="badge">0</span><span class="emo">${p.emo}</span>${p.name}<br>${fromC(toC(p.price))}`;
    btn.onclick=()=>{ counters[p.id]++; updateTotals(); };
    $grid.appendChild(btn);
  });
  updateTotals();
}

/* ====== Mise √† jour totaux + badges + d√©tail ====== */
function updateTotals(){
  let total=0,count=0;
  Object.values(categories).flat().forEach(p=>{
    const q=counters[p.id]; total+=toC(p.price)*q; count+=q;
    const badge=$grid.querySelector(`[data-id="${p.id}"] .badge`);
    if(badge){ badge.textContent=q; badge.style.display=q>0?'inline-block':'none'; }
  });
  $totalTxt.textContent=fromC(total);
  $countTxt.textContent=count;
  renderDetails();
}

/* ====== D√©tail de commande (avec ‚úñ) ====== */
function renderDetails(){
  const lines=[];
  Object.values(categories).flat().forEach(p=>{
    const q=counters[p.id]; if(q<=0) return;
    lines.push(`<div class="line" data-id="${p.id}">
      <div>${p.emo} ${p.name} <span class="muted">√ó ${q}</span></div>
      <div class="muted">${fromC(toC(p.price))}</div>
      <div><strong>${fromC(toC(p.price)*q)}</strong> <button class="remove" title="Retirer 1">‚úñ</button></div>
    </div>`);
  });
  $details.innerHTML=lines.join("")||"<div class='muted'>Aucun article</div>";
}

/* Ouvrir/fermer le d√©tail en cliquant sur le bloc total */
$totalsPanel.addEventListener("click",(e)=>{
  if(e.target.closest(".remove")) return; // ne ferme pas si clic sur ‚úñ
  const open=!$details.hasAttribute("hidden");
  if(open){$details.setAttribute("hidden","");$chev.textContent="‚ñ∏";}
  else{$details.removeAttribute("hidden");$chev.textContent="‚ñæ";}
});

/* Retirer 1 avec ‚úñ (sans fermer le d√©tail) */
$details.addEventListener("click",(e)=>{
  const rm=e.target.closest(".remove");
  if(!rm) return;
  e.stopPropagation();
  const line=e.target.closest(".line");
  const id=line?.dataset.id;
  if(!id) return;
  if(counters[id]>0){ counters[id]--; updateTotals(); }
});

/* Vider la commande */
$clear.addEventListener('click', ()=>{
  Object.keys(counters).forEach(k=>counters[k]=0);
  updateTotals();
  if(!$details.hasAttribute('hidden')) renderDetails();
});

/* ====== Init ====== */
renderTabs(); renderGrid();
</script>
</body>
</html>
