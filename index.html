<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Caisse rapide ‚Äì Prototype onglets</title>
<style>
  :root{--bg:#0f1217;--panel:#171b22;--text:#e6e9ef;--muted:#9aa3b2;--accent:#3b82f6}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{padding:12px;background:var(--panel)}
  h1{margin:0;font-size:18px}
  /* Tabs */
  .tabs{display:flex;gap:6px;overflow:auto;padding:8px 12px;background:#0e131a;border-bottom:1px solid #222833}
  .tab{padding:6px 12px;border-radius:999px;border:1px solid #243042;background:#0b1016;color:var(--text);cursor:pointer;white-space:nowrap;font-size:14px}
  .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
  /* Grid produits */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;padding:12px}
  .item{appearance:none;-webkit-appearance:none;border:1px solid #222833;background:#0e131a;color:inherit;border-radius:12px;padding:10px;cursor:pointer;position:relative;text-align:center}
  .item .emo{display:block;font-size:24px;margin-bottom:4px}
  .item .badge{position:absolute;top:6px;right:6px;background:var(--accent);color:#fff;border-radius:999px;padding:2px 6px;font-size:12px;display:none}
  /* Totaux */
  .panel{background:var(--panel);margin:12px;border-radius:12px;padding:12px}
  .row{display:flex;justify-content:space-between;align-items:center}
  .big{font-size:26px;font-weight:800}
  .muted{color:var(--muted);font-size:12px}
  .chev{font-size:16px;color:var(--muted)}
  #details{margin-top:8px;border-top:1px dashed #243042;padding-top:8px}
  .line{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:6px 0}
  .remove{border:1px solid #3a2222;background:#2a1515;color:#ffb4b4;border-radius:8px;height:28px;padding:0 8px;cursor:pointer}
</style>
</head>
<body>
  <header><h1>üçπ Caisse rapide ‚Äì D√©mo</h1></header>

  <!-- Onglets -->
  <div class="tabs" id="tabs"></div>

  <!-- Zone produits -->
  <div class="grid" id="grid"></div>

  <!-- Totaux -->
  <div class="panel" id="totalsPanel">
    <div class="row">
      <div>
        <div class="muted">Total</div>
        <div class="big" id="totalTxt">0,00 ‚Ç¨</div>
      </div>
      <div>
        <div class="muted">Articles</div>
        <div class="big"><span id="countTxt">0</span> <span class="chev" id="chev">‚ñ∏</span></div>
      </div>
    </div>
    <div id="details" hidden></div>
  </div>

<script>
const fmt = new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'});
const toCents = v => Math.round(parseFloat(String(v).replace(',','.'))*100);
const fromCents = c => fmt.format(c/100);

// Cat√©gories avec quelques produits de test
const categories = {
  "‚òï Chauds":[
    {id:"cafe",name:"Caf√©",price:0.5,emo:"‚òï"},
    {id:"choco",name:"Chocolat chaud",price:0.5,emo:"üç´"}
  ],
  "üç¨ Confiserie":[
    {id:"kitkat",name:"KitKat",price:0.5,emo:"üç´"},
    {id:"cotedor",name:"C√¥te d'Or",price:1.0,emo:"üç´"}
  ],
  "ü•§ Fra√Æches":[
    {id:"canette",name:"Canette",price:0.8,emo:"ü•§"},
    {id:"jus",name:"Jus de fruits",price:0.9,emo:"üßÉ"}
  ],
  "üç∫ Bi√®res":[
    {id:"pression",name:"Pelforth Pression",price:1.0,emo:"üç∫"},
    {id:"despe",name:"Desperados",price:1.5,emo:"üçª"}
  ],
  "üç∑ Vins":[
    {id:"rose",name:"Ros√© verre",price:0.6,emo:"üç∑"},
    {id:"blanc",name:"Blanc verre",price:0.9,emo:"ü•Ç"}
  ]
};

let counters = {}; // id ‚Üí quantit√©
Object.values(categories).flat().forEach(p=>counters[p.id]=0);

let activeCat = Object.keys(categories)[0];

// Elements
const $tabs=document.getElementById("tabs");
const $grid=document.getElementById("grid");
const $totalTxt=document.getElementById("totalTxt");
const $countTxt=document.getElementById("countTxt");
const $details=document.getElementById("details");
const $totalsPanel=document.getElementById("totalsPanel");
const $chev=document.getElementById("chev");

function renderTabs(){
  $tabs.innerHTML="";
  Object.keys(categories).forEach(cat=>{
    const b=document.createElement("button");
    b.className="tab"+(cat===activeCat?" active":"");
    b.textContent=cat;
    b.addEventListener("click",()=>{activeCat=cat;renderTabs();renderGrid();});
    $tabs.appendChild(b);
  });
}
function renderGrid(){
  $grid.innerHTML="";
  categories[activeCat].forEach(p=>{
    const btn=document.createElement("button");
    btn.type="button";btn.className="item";btn.dataset.id=p.id;btn.dataset.price=p.price;btn.dataset.name=p.name;
    btn.innerHTML=`<span class="badge">0</span><span class="emo">${p.emo}</span>${p.name}<br>${fromCents(toCents(p.price))}`;
    btn.addEventListener("click",()=>{
      counters[p.id]++;updateTotals();
    });
    $grid.appendChild(btn);
  });
  updateTotals();
}
function updateTotals(){
  let total=0,count=0;
  Object.values(categories).flat().forEach(p=>{
    total+=toCents(p.price)*counters[p.id];
    count+=counters[p.id];
    const el=$grid.querySelector(`[data-id="${p.id}"] .badge`);
    if(el){ el.textContent=counters[p.id]; el.style.display=counters[p.id]>0?"inline-block":"none"; }
  });
  $totalTxt.textContent=fromCents(total);
  $countTxt.textContent=count;
  renderDetails();
}
function renderDetails(){
  const lines=[];
  Object.values(categories).flat().forEach(p=>{
    const q=counters[p.id];
    if(q>0){
      lines.push(`<div class="line" data-id="${p.id}">
        <div>${p.emo} ${p.name} <span class="muted">√ó${q}</span></div>
        <div class="muted">${fromCents(toCents(p.price))}</div>
        <div><strong>${fromCents(toCents(p.price)*q)}</strong> <button class="remove">‚úñ</button></div>
      </div>`);
    }
  });
  $details.innerHTML=lines.join("")||"<div class='muted'>Aucun article</div>";
}
$totalsPanel.addEventListener("click",(e)=>{
  if(e.target.closest(".remove")) return; // ne pas fermer si clic ‚úñ
  const open=!$details.hasAttribute("hidden");
  if(open){$details.setAttribute("hidden","");$chev.textContent="‚ñ∏";}else{$details.removeAttribute("hidden");$chev.textContent="‚ñæ";}
});
$details.addEventListener("click",(e)=>{
  const rm=e.target.closest(".remove");
  if(!rm)return;
  e.stopPropagation();
  const id=e.target.closest(".line").dataset.id;
  if(counters[id]>0){counters[id]--;updateTotals();}
});

renderTabs();renderGrid();
</script>
</body>
</html>
